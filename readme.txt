今回はオリジナルでカードゲーム作っています。
タイトルは『あかつきを』
*追記①2020/07/31 23:31記載開始。

＊全体共通
functions.phpはデータベース接続とセッションチェック。特に講義内容から変わらず。
sqlは提出ルールと自己防衛のために全体のものも提出していますが、実際に使用しているakatsuki_…の2つのsqlも別途提出。

＊関連する構造
index.php→style.css, system.js
game.php→gamestyle.css, gamesystem.js
reset.cssは共通。

①概要
②登録ログイン関連
③index.phpから呼び込むphpファイル
④game.phpから呼び込むphpファイル

①概要
オリジナルカードゲームです。オンライン対戦可能にするためにfirebaseとも連携しています(game.php 69行目にコレクション名記述)。あとは勝敗がつくのでレーティングシステム導入。16種類のカードから6枚配られて、順に選択、全部使いきったときに点数の高い方の勝ち。みたいな構造です。
が、ゲームの動きの部分は作りましたが、あとはゲームバランスを作って、点数計算用のロジックを作ったら完成みたいな感じです。動き部分は完了しているという状態での提出。
土曜日までには完成、デプロイの意気込み。
ちなみに趣のあるフォントを選んだものの、かなカナしか使えず世界観完遂できず。

②登録ログイン関連
の前にindex.phpの時点でusernameがポストされているかをチェック。されてなければゲスト判定して要素生成。ログインしなくても対戦以外は見れます。
アカウントを作る→要素記入後にとうろくでregister_act.phpを起動。同名や処理に利用するため禁止されたネーム以外は完了して, sessionにusernameとvisible_idを保存してindex.phpをリロードします。
ログイン→記入があっていればlogin_act.phpが起動して、以下同上。
ログアウト→セッション空にしてindex.phpをリロード。

③index.phpから呼び込むphpファイル
あそぶbtn→game.phpへ移行。
あそびかたbtn→もともと生成してあるruleを表示。
ふだのやまbtn→pool_get.phpへリクエストして_pool_tableから全件取得して表示します。hoverするとtextget.phpにリクエストしてtextが出力されます。
じゅんいbtn→ranking_get.phpへリクエストしてuser_rating_point上位10件を取得して表示します。同レートの表示順位が適正化されていなかったり、１戦もしてなくても初期レート値1500が反映されてしまいます。よくない。

④game.phpから呼び込むphpファイル及びfirebaseへの指示監視。
時系列
host guest判定
hostaction または guestaction
札のどれかを『ここにドロップ』にドロップ。→ドロップされたカード番号がfirebase update
取得したカード番号をもとにpoint_caliculate.phpへ送り現状のpointを更新。再度firebaseへ。
現状のpointを取得すると表示処理が行われて、とじるボタンを押せるようになる。以下ループ。
host側はasayoruを更新。ランダムで切り替わります。完全に運。
6回終わると勝敗判定に入り、勝敗と自分の名前、相手の名前をrating_update.phpへ送り_rating_pointを更新します。
それが終わると退出するを押せるようになり、index.phpへ戻ります。その際、host側はfirebaseのドキュメントを破壊します。

point_caliculate.phpへ送る必要のあるデータはゲームバランス作成後は増える想定です。コンボとか繋げたいので、直前プレイのカードも残しておく必要があるなど。
あとは通信待機中の文言もポイント関係でテキストの表示更新が行われる予定。


----------------------------------
追記①
・カードプールを調整。加えて点数計算ロジックも追加。ゲームになりました。
・ホスト側待機中に退出するボタンを表示。ゲーム終了時退出と同様サーバードキュメントを破壊。
・真ん中の朝夜のテキストが入れ替わってないのを修正。
・獲得ポイントがテキストとして反映されるように修正。
その他細かい記述変更あり。デプロイ可能になりました。
